name: Release draft tsterm
on:
  workflow_dispatch:
    inputs:
      BUMP_TYPE:
        description: 'When version bumping, set patch, minor, or major'
        required: false
      RELEASE_NUMBER:
        description: 'Disable bumping by specifying a semver pattern (without v).'
        required: false
      RUN_ID:
        description: 'Specify run id of asset to associate with release.'
        reqiured: false

permissions:
  contents: write
        
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: '[Download] Default'
        if: ${{ inputs.RUN_ID == '' }}
        env:
          GH_TOKEN: ${{ github.token }}
        run: gh run download $(gh run list -w "Build tsterm" --json databaseId -q .[0].databaseId)
      - name: '[Download] Input'
        if: ${{ inputs.RUN_ID }}
        env:
          GH_TOKEN: ${{ github.token }}
        run: gh run download ${{ inputs.RUN_ID }}
      - name: '[Create tag]'
        id: tag_version
        uses: mathieudutour/github-tag-action@v6.1
        with:
          github_token: ${{ github.token }}
          default_bump: ${{ inputs.BUMP_TYPE }}
          custom_tag: ${{ inputs.RELEASE_NUMBER }}
      - name: '[Create release]'
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.tag_version.outputs.new_tag }}
          name: Release ${{ steps.tag_version.outputs.new_tag }}
          draft: true
          prerelease: false
          token: ${{ github.token }}
          #body_path: CHANGELOG.md
          files: tsterm/*
